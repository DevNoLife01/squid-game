<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squid Game - Multiplayer</title>
    
    <!-- React and Babel CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        squidRed: '#E50914',
                        squidGreen: '#00A86B',
                        squidPink: '#FF007F',
                        squidDark: '#0A0A0A',
                        squidGray: '#1A1A1A',
                        squidLightGray: '#AAAAAA',
                        squidGold: '#FFD700',
                    },
                    fontFamily: {
                        'orbitron': ['Orbitron', 'monospace'],
                        'mono': ['Roboto Mono', 'monospace'],
                    },
                    keyframes: {
                        'squid-pulse': {
                            '0%, 100%': { 
                                transform: 'scale(1)',
                                textShadow: '0 0 20px #FF007F, 0 0 40px #FF007F, 0 0 60px #FF007F'
                            },
                            '50%': { 
                                transform: 'scale(1.05)',
                                textShadow: '0 0 30px #FF007F, 0 0 60px #FF007F, 0 0 90px #FF007F'
                            },
                        },
                        'logo-spin': {
                            '0%': { transform: 'rotate(0deg) scale(0.8)', opacity: '0' },
                            '50%': { transform: 'rotate(180deg) scale(1.1)', opacity: '0.8' },
                            '100%': { transform: 'rotate(360deg) scale(1)', opacity: '1' },
                        },
                        'slide-in-left': {
                            '0%': { transform: 'translateX(-100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        'slide-in-right': {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        'slide-in-up': {
                            '0%': { transform: 'translateY(100%)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        'slide-in-down': {
                            '0%': { transform: 'translateY(-100%)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                        'bounce-in': {
                            '0%': { transform: 'scale(0.3)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)' },
                            '70%': { transform: 'scale(0.9)' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        'glitch': {
                            '0%, 100%': { transform: 'translate(0)' },
                            '20%': { transform: 'translate(-2px, 2px)' },
                            '40%': { transform: 'translate(-2px, -2px)' },
                            '60%': { transform: 'translate(2px, 2px)' },
                            '80%': { transform: 'translate(2px, -2px)' },
                        },
                        'loading-dots': {
                            '0%, 80%, 100%': { transform: 'scale(0)' },
                            '40%': { transform: 'scale(1)' },
                        },
                        'card-hover': {
                            '0%': { transform: 'translateY(0) rotateX(0)' },
                            '100%': { transform: 'translateY(-10px) rotateX(5deg)' },
                        },
                        'neon-border': {
                            '0%, 100%': { 
                                boxShadow: '0 0 5px #FF007F, 0 0 10px #FF007F, 0 0 15px #FF007F, inset 0 0 5px #FF007F'
                            },
                            '50%': { 
                                boxShadow: '0 0 10px #FF007F, 0 0 20px #FF007F, 0 0 30px #FF007F, inset 0 0 10px #FF007F'
                            },
                        },
                        'particle-float': {
                            '0%, 100%': { transform: 'translateY(0px) rotate(0deg)' },
                            '33%': { transform: 'translateY(-30px) rotate(120deg)' },
                            '66%': { transform: 'translateY(-60px) rotate(240deg)' },
                        },
                    },
                    animation: {
                        'squid-pulse': 'squid-pulse 2s ease-in-out infinite',
                        'logo-spin': 'logo-spin 2s ease-out',
                        'slide-in-left': 'slide-in-left 0.6s ease-out',
                        'slide-in-right': 'slide-in-right 0.6s ease-out',
                        'slide-in-up': 'slide-in-up 0.6s ease-out',
                        'slide-in-down': 'slide-in-down 0.6s ease-out',
                        'fade-in': 'fade-in 0.8s ease-out',
                        'bounce-in': 'bounce-in 0.8s ease-out',
                        'glitch': 'glitch 0.3s ease-in-out infinite',
                        'loading-dots': 'loading-dots 1.4s ease-in-out infinite',
                        'card-hover': 'card-hover 0.3s ease-out forwards',
                        'neon-border': 'neon-border 2s ease-in-out infinite',
                        'particle-float': 'particle-float 6s ease-in-out infinite',
                    },
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            background: linear-gradient(135deg, #0A0A0A 0%, #1A1A1A 50%, #0A0A0A 100%);
            color: #AAAAAA;
            overflow-x: hidden;
        }
        
        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .mobile-text-sm { font-size: 0.875rem; }
            .mobile-text-base { font-size: 1rem; }
            .mobile-text-lg { font-size: 1.125rem; }
            .mobile-text-xl { font-size: 1.25rem; }
            .mobile-text-2xl { font-size: 1.5rem; }
            .mobile-text-3xl { font-size: 1.875rem; }
            .mobile-text-4xl { font-size: 2.25rem; }
            .mobile-p-2 { padding: 0.5rem; }
            .mobile-p-4 { padding: 1rem; }
            .mobile-px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
            .mobile-py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
            .mobile-m-2 { margin: 0.5rem; }
            .mobile-mb-4 { margin-bottom: 1rem; }
            .mobile-h-48 { height: 12rem; }
            .mobile-h-64 { height: 16rem; }
        }
        
        /* Animated Background */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 80%, rgba(229, 9, 20, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 127, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 168, 107, 0.05) 0%, transparent 50%);
            animation: particle-float 20s ease-in-out infinite;
        }
        
        /* Particle System */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FF007F;
            border-radius: 50%;
            animation: particle-float 8s linear infinite;
        }
        
        .particle:nth-child(2n) {
            background: #00A86B;
            animation-duration: 12s;
            animation-delay: -2s;
        }
        
        .particle:nth-child(3n) {
            background: #E50914;
            animation-duration: 10s;
            animation-delay: -4s;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #0A0A0A;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #E50914, #FF007F);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #FF007F, #E50914);
        }
        
        /* Loading Animation */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: radial-gradient(circle, #1A1A1A 0%, #0A0A0A 100%);
        }
        
        .squid-logo {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(45deg, #E50914, #FF007F, #00A86B);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: squid-pulse 2s ease-in-out infinite, logo-spin 2s ease-out;
        }
        
        @media (max-width: 768px) {
            .squid-logo {
                font-size: 2rem;
            }
        }
        
        .loading-dots {
            display: flex;
            gap: 8px;
            margin-top: 2rem;
        }
        
        .loading-dot {
            width: 12px;
            height: 12px;
            background: #FF007F;
            border-radius: 50%;
            animation: loading-dots 1.4s ease-in-out infinite;
        }
        
        .loading-dot:nth-child(2) {
            animation-delay: 0.2s;
            background: #E50914;
        }
        
        .loading-dot:nth-child(3) {
            animation-delay: 0.4s;
            background: #00A86B;
        }
        
        /* Enhanced Button Styles */
        .btn-enhanced {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background: linear-gradient(45deg, var(--bg-color), var(--bg-color)) padding-box,
                        linear-gradient(45deg, #FF007F, #E50914) border-box;
            min-height: 44px; /* Touch-friendly minimum */
        }
        
        .btn-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-enhanced:hover::before {
            left: 100%;
        }
        
        .btn-enhanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 0, 127, 0.3);
        }
        
        /* Card Enhancements */
        .card-enhanced {
            backdrop-filter: blur(10px);
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(255, 0, 127, 0.3);
            transition: all 0.3s ease;
        }
        
        .card-enhanced:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(255, 0, 127, 0.2);
            border-color: rgba(255, 0, 127, 0.6);
        }
        
        /* Game Screen Transitions */
        .screen-transition {
            animation: fade-in 0.8s ease-out;
        }
        
        /* Glitch Effect for Elimination */
        .elimination-glitch {
            animation: glitch 0.3s ease-in-out infinite;
        }
        
        /* Progress Bar Enhancements */
        .progress-enhanced {
            background: linear-gradient(90deg, #1A1A1A, #333333);
            border: 1px solid rgba(255, 0, 127, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        .progress-enhanced::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: particle-float 2s linear infinite;
        }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    <div id="particles"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Firebase Configuration - Updated with your credentials
        const firebaseConfig = {
            apiKey: "AIzaSyDRuM4wLGmEPIAlsDPSuwXe0zpGBgy_qZY",
            authDomain: "squid-game-9e67b.firebaseapp.com",
            databaseURL: "https://squid-game-9e67b-default-rtdb.firebaseio.com/",
            projectId: "squid-game-9e67b",
            storageBucket: "squid-game-9e67b.firebasestorage.app",
            messagingSenderId: "293616185386",
            appId: "1:293616185386:web:0a4111289743f779639353",
            measurementId: "G-GP1SVFN73K"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Web Audio API Sound Generator
        const SoundGenerator = {
            audioContext: null,
            
            init() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            },
            
            playTone(frequency, duration, type = 'sine', volume = 0.3) {
                this.init();
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(volume, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            },
            
            playSuccess() {
                // Happy ascending tone
                this.playTone(523.25, 0.2); // C5
                setTimeout(() => this.playTone(659.25, 0.2), 100); // E5
                setTimeout(() => this.playTone(783.99, 0.3), 200); // G5
            },
            
            playError() {
                // Harsh descending tone
                this.playTone(220, 0.5, 'sawtooth', 0.4); // A3
            },
            
            playElimination() {
                // Dramatic elimination sound
                this.playTone(110, 1.0, 'sawtooth', 0.5); // A2
                setTimeout(() => this.playTone(98, 0.5, 'square', 0.3), 200); // G2
            },
            
            playNotification() {
                // Notification beep
                this.playTone(800, 0.1);
                setTimeout(() => this.playTone(1000, 0.1), 150);
            },
            
            playClick() {
                // Button click sound
                this.playTone(1200, 0.05, 'square', 0.2);
            }
        };

        // Enhanced playSound function
        const playSound = (soundType) => {
            try {
                switch(soundType) {
                    case 'win-sound.mp3':
                    case 'success':
                        SoundGenerator.playSuccess();
                        break;
                    case 'elimination-sound.mp3':
                    case 'elimination':
                        SoundGenerator.playElimination();
                        break;
                    case 'pull-sound.mp3':
                    case 'hit-sound.mp3':
                    case 'click':
                        SoundGenerator.playClick();
                        break;
                    case 'glass-shatter.mp3':
                    case 'error':
                        SoundGenerator.playError();
                        break;
                    case 'glass-safe.mp3':
                    case 'notification':
                        SoundGenerator.playNotification();
                        break;
                    default:
                        SoundGenerator.playClick();
                }
            } catch (e) {
                console.log("Audio play failed:", e);
            }
        };

        // Particle System Component
        const ParticleSystem = () => {
            useEffect(() => {
                const particlesContainer = document.getElementById('particles');
                if (!particlesContainer) return;

                const createParticle = () => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 8 + 's';
                    particlesContainer.appendChild(particle);

                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 8000);
                };

                const interval = setInterval(createParticle, 500);
                
                // Create initial particles
                for (let i = 0; i < 20; i++) {
                    setTimeout(createParticle, i * 100);
                }

                return () => clearInterval(interval);
            }, []);

            return null;
        };

        // Loading Screen Component
        const LoadingScreen = ({ onLoadComplete }) => {
            useEffect(() => {
                const timer = setTimeout(() => {
                    onLoadComplete();
                }, 3000);

                return () => clearTimeout(timer);
            }, [onLoadComplete]);

            return (
                <div className="loading-container screen-transition px-4">
                    <div className="squid-logo font-orbitron">
                        SQUID GAME
                    </div>
                    <div className="text-squidPink mobile-text-lg mt-4 animate-fade-in text-center">
                        Multiplayer Edition
                    </div>
                    <div className="loading-dots">
                        <div className="loading-dot"></div>
                        <div className="loading-dot"></div>
                        <div className="loading-dot"></div>
                    </div>
                    <div className="text-squidLightGray mobile-text-sm mt-8 animate-slide-in-up text-center">
                        Connecting to game servers...
                    </div>
                </div>
            );
        };

        // Utility Functions
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error(error);
                    return initialValue;
                }
            });

            const setValue = (value) => {
                try {
                    setStoredValue(value);
                    window.localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.error(error);
                }
            };

            return [storedValue, setValue];
        };

        // Enhanced Button Component
        const Button = ({ children, onClick, disabled, className, variant = "primary", ...props }) => {
            const baseClasses = "btn-enhanced px-4 py-3 md:px-6 md:py-3 rounded-lg font-bold transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none mobile-text-base";
            
            const variants = {
                primary: "bg-squidRed text-white hover:bg-squidRed/90",
                secondary: "bg-squidGreen text-white hover:bg-squidGreen/90",
                accent: "bg-squidPink text-white hover:bg-squidPink/90",
                ghost: "bg-transparent border-2 border-squidPink text-squidPink hover:bg-squidPink hover:text-white",
            };

            const handleClick = (e) => {
                playSound('click');
                if (onClick) onClick(e);
            };

            return (
                <button
                    onClick={handleClick}
                    disabled={disabled}
                    className={`${baseClasses} ${variants[variant]} ${className}`}
                    style={{ '--bg-color': variant === 'primary' ? '#E50914' : variant === 'secondary' ? '#00A86B' : '#FF007F' }}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        // Enhanced Input Component
        const Input = ({ className, ...props }) => (
            <input
                className={`px-3 py-3 md:px-4 md:py-3 rounded-lg border-2 border-squidPink/30 bg-squidGray/50 text-squidLightGray focus:outline-none focus:border-squidPink focus:ring-2 focus:ring-squidPink/20 transition-all duration-300 backdrop-blur-sm mobile-text-base ${className}`}
                {...props}
            />
        );

        // Enhanced Card Components
        const Card = ({ children, className, animated = true }) => (
            <div className={`card-enhanced rounded-xl shadow-2xl mobile-m-2 ${animated ? 'animate-bounce-in' : ''} ${className}`}>
                {children}
            </div>
        );

        const CardHeader = ({ children, className }) => (
            <div className={`p-4 md:p-6 ${className}`}>
                {children}
            </div>
        );

        const CardTitle = ({ children, className }) => (
            <h3 className={`font-bold mobile-text-xl md:text-2xl font-orbitron ${className}`}>
                {children}
            </h3>
        );

        const CardContent = ({ children, className }) => (
            <div className={`p-4 md:p-6 pt-0 ${className}`}>
                {children}
            </div>
        );

        // Enhanced Progress Component
        const Progress = ({ value, className, animated = true }) => (
            <div className={`progress-enhanced w-full h-3 md:h-4 rounded-full ${className}`}>
                <div
                    className={`h-full bg-gradient-to-r from-squidGreen to-squidPink rounded-full transition-all duration-500 ${animated ? 'animate-pulse' : ''}`}
                    style={{ width: `${Math.min(Math.max(value, 0), 100)}%` }}
                />
            </div>
        );

        // Admin Login Component
        const AdminLogin = ({ onLoginSuccess }) => {
            const [username, setUsername] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");

            const handleLogin = (e) => {
                e.preventDefault();
                if (username === "DevNoLife" && password === "enaz8karakter") {
                    playSound('success');
                    onLoginSuccess();
                } else {
                    playSound('error');
                    setError("Invalid username or password.");
                }
            };

            return (
                <div className="flex items-center justify-center min-h-screen bg-squidDark screen-transition px-4">
                    <Card className="w-full max-w-md animate-slide-in-down">
                        <CardHeader className="text-center">
                            <CardTitle className="text-squidRed animate-squid-pulse">üé≠ Admin Access</CardTitle>
                            <p className="text-squidLightGray mt-2 animate-fade-in mobile-text-sm">Enter your credentials to manage the game.</p>
                        </CardHeader>
                        <CardContent>
                            <form onSubmit={handleLogin} className="space-y-4 md:space-y-6">
                                <Input
                                    type="text"
                                    placeholder="üë§ Username"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    className="w-full animate-slide-in-left"
                                    required
                                />
                                <Input
                                    type="password"
                                    placeholder="üîí Password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full animate-slide-in-right"
                                    required
                                />
                                {error && <p className="text-squidRed mobile-text-sm text-center animate-bounce-in elimination-glitch">{error}</p>}
                                <Button
                                    type="submit"
                                    className="w-full animate-slide-in-up"
                                    variant="primary"
                                >
                                    üöÄ Login
                                </Button>
                            </form>
                        </CardContent>
                    </Card>
                </div>
            );
        };

        // Admin Dashboard Component
        const AdminDashboard = ({ onLogout, players, gameId, setGameId, currentRound }) => {
            const [showSuccess, setShowSuccess] = useState(false);

            const handleCreateGame = async () => {
                const generatedId = Math.random().toString(36).substring(2, 8).toUpperCase();
                setGameId(generatedId);

                await database.ref(`games/${generatedId}`).set({
                    currentRound: 0,
                    status: "lobby",
                    players: {}
                });

                playSound('success');
                setShowSuccess(true);
                setTimeout(() => setShowSuccess(false), 3000);
            };

            const handleStartGame = async () => {
                if (!gameId) return;
                await database.ref(`games/${gameId}`).update({
                    currentRound: 1,
                    status: "playing"
                });
                playSound('success');
            };

            const handleEliminatePlayer = async (playerId) => {
                if (!gameId) return;
                await database.ref(`games/${gameId}/players/${playerId}`).update({
                    isEliminated: true
                });
                playSound('elimination');
            };

            const handleNextRound = async () => {
                if (!gameId) return;
                const nextRound = currentRound + 1;
                await database.ref(`games/${gameId}`).update({
                    currentRound: nextRound
                });
                playSound('success');
            };

            const [announcementText, setAnnouncementText] = useState("");
            const [showAnnouncementInput, setShowAnnouncementInput] = useState(false);

            const handleSendAnnouncement = async () => {
                if (!gameId || !announcementText.trim()) return;
                
                const announcement = {
                    text: announcementText.trim(),
                    timestamp: Date.now(),
                    id: Math.random().toString(36).substring(2, 9)
                };
                
                await database.ref(`games/${gameId}/announcement`).set(announcement);
                setAnnouncementText("");
                setShowAnnouncementInput(false);
                playSound('notification');
                
                // Auto-clear announcement after 10 seconds
                setTimeout(async () => {
                    await database.ref(`games/${gameId}/announcement`).remove();
                }, 10000);
            };

            return (
                <div className="min-h-screen bg-squidDark text-squidLightGray p-4 md:p-8 screen-transition">
                    <div className="max-w-6xl mx-auto">
                        <h1 className="mobile-text-3xl md:text-5xl font-bold text-squidRed mb-6 md:mb-8 text-center font-orbitron animate-squid-pulse">
                            üéÆ Admin Dashboard
                        </h1>
                        
                        {showSuccess && (
                            <div className="mb-4 md:mb-6 p-3 md:p-4 bg-squidGreen/20 border border-squidGreen rounded-lg text-center animate-bounce-in">
                                <p className="text-squidGreen font-bold mobile-text-lg md:text-xl">
                                    üéâ Game Created Successfully! Share the Game ID with players.
                                </p>
                            </div>
                        )}
                        
                        <div className="grid grid-cols-1 gap-4 md:gap-8 mb-6 md:mb-8">
                            <Card className="animate-slide-in-left">
                                <CardHeader>
                                    <CardTitle className="text-squidPink">üéØ Game Session</CardTitle>
                                </CardHeader>
                                <CardContent className="space-y-3 md:space-y-4">
                                    <div className="flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-2">
                                        <label className="text-squidLightGray font-semibold mobile-text-sm">üÜî Current Game ID:</label>
                                        <Input
                                            value={gameId || "N/A"}
                                            readOnly
                                            className="flex-1 text-squidGreen font-mono mobile-text-lg animate-neon-border"
                                        />
                                        {gameId && (
                                            <Button
                                                onClick={() => navigator.clipboard.writeText(gameId)}
                                                className="px-3 py-2 mobile-text-sm"
                                                variant="ghost"
                                            >
                                                üìã Copy
                                            </Button>
                                        )}
                                    </div>
                                    <Button
                                        onClick={handleCreateGame}
                                        className="w-full"
                                        variant="secondary"
                                    >
                                        ‚ú® {gameId ? "Generate New Game ID" : "Create New Game"}
                                    </Button>
                                    {gameId && (
                                        <Button
                                            onClick={handleStartGame}
                                            className="w-full animate-bounce-in"
                                            variant="primary"
                                        >
                                            üöÄ Start Game
                                        </Button>
                                    )}
                                    <Button
                                        onClick={handleNextRound}
                                        disabled={!gameId || currentRound >= 6}
                                        className="w-full"
                                        variant="accent"
                                    >
                                        ‚è≠Ô∏è Next Round (Current: {currentRound})
                                    </Button>
                                    <div className="mt-3 md:mt-4 space-y-2">
                                        <Button
                                            onClick={() => setShowAnnouncementInput(!showAnnouncementInput)}
                                            className="w-full"
                                            variant="accent"
                                        >
                                            üì¢ {showAnnouncementInput ? "Cancel Announcement" : "Send Announcement"}
                                        </Button>
                                        
                                        {showAnnouncementInput && (
                                            <div className="space-y-3 animate-slide-in-down">
                                                <Input
                                                    type="text"
                                                    placeholder="üìù Type your announcement here..."
                                                    value={announcementText}
                                                    onChange={(e) => setAnnouncementText(e.target.value)}
                                                    className="w-full"
                                                    maxLength={200}
                                                />
                                                <div className="flex justify-between items-center">
                                                    <span className="mobile-text-sm text-squidLightGray">
                                                        {announcementText.length}/200 characters
                                                    </span>
                                                    <Button
                                                        onClick={handleSendAnnouncement}
                                                        disabled={!announcementText.trim()}
                                                        className="px-4 md:px-6"
                                                        variant="secondary"
                                                    >
                                                        üöÄ Send Now
                                                    </Button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </CardContent>
                            </Card>

                            <Card className="animate-slide-in-right">
                                <CardHeader>
                                    <CardTitle className="text-squidGreen">üë• Player Management</CardTitle>
                                </CardHeader>
                                <CardContent className="space-y-3 md:space-y-4">
                                    <h3 className="mobile-text-lg md:text-xl font-semibold text-squidLightGray">
                                        üé≠ Connected Players ({players.length})
                                    </h3>
                                    <div className="mobile-h-48 md:h-64 w-full rounded-lg border-2 border-squidPink/30 p-3 md:p-4 bg-squidGray/30 overflow-y-auto backdrop-blur-sm">
                                        {players.length === 0 ? (
                                            <p className="text-squidLightGray/70 text-center animate-pulse mobile-text-sm">
                                                üîç No players connected yet...
                                            </p>
                                        ) : (
                                            <ul className="space-y-2 md:space-y-3">
                                                {players.map((player, index) => (
                                                    <li key={player.id} className={`flex items-center justify-between text-squidLightGray p-2 md:p-3 rounded-lg bg-squidGray/50 animate-slide-in-up`} style={{ animationDelay: `${index * 0.1}s` }}>
                                                        <span className="flex items-center space-x-2 md:space-x-3">
                                                            <span className="font-mono text-squidGreen font-bold mobile-text-sm">#{player.number}</span>
                                                            <span className="font-semibold mobile-text-sm">{player.name}</span>
                                                            {player.isEliminated && <span className="text-squidRed font-bold animate-pulse mobile-text-sm">üíÄ ELIMINATED</span>}
                                                        </span>
                                                        {!player.isEliminated && (
                                                            <Button
                                                                onClick={() => handleEliminatePlayer(player.id)}
                                                                className="mobile-text-sm px-2 py-1 md:px-3 md:py-1"
                                                                variant="primary"
                                                            >
                                                                ‚ùå Eliminate
                                                            </Button>
                                                        )}
                                                    </li>
                                                ))}
                                            </ul>
                                        )}
                                    </div>
                                </CardContent>
                            </Card>
                        </div>

                        <div className="text-center mt-6 md:mt-8">
                            <Button
                                onClick={onLogout}
                                className="font-bold py-3 px-6 md:px-8 animate-bounce-in"
                                variant="ghost"
                            >
                                üö™ Logout
                            </Button>
                        </div>
                    </div>
                </div>
            );
        };

        // Lobby Component
        const Lobby = ({ onJoinGame, players, gameId, onStartGame, isAdmin, currentRound, currentPlayerId }) => {
            const [joinCode, setJoinCode] = useState("");
            const [playerName, setPlayerName] = useState("");
            const [error, setError] = useState("");
            const [coins] = useLocalStorage("squid-game-coins", 0);

            const handleJoin = async () => {
                if (!joinCode || !playerName) {
                    setError("Please enter a game code and your player name.");
                    playSound('error');
                    return;
                }

                const snapshot = await database.ref(`games/${joinCode}`).once('value');
                if (!snapshot.exists()) {
                    setError("Game code does not exist.");
                    playSound('error');
                    return;
                }

                setError("");
                playSound('success');
                const newPlayerId = `player-${Date.now()}`;
                onJoinGame(joinCode, playerName, newPlayerId);
            };

            return (
                <div className="min-h-screen bg-squidDark text-squidLightGray p-4 md:p-8 flex flex-col items-center justify-center screen-transition">
                    <div className="max-w-4xl w-full mx-auto">
                        <h1 className="mobile-text-4xl md:text-6xl font-bold text-squidRed mb-6 md:mb-8 text-center font-orbitron animate-squid-pulse">
                            ü¶ë SQUID GAME
                        </h1>
                        <p className="mobile-text-lg md:text-xl text-squidPink text-center mb-6 md:mb-8 animate-fade-in">
                            üéÆ Multiplayer Battle Royale Edition
                        </p>

                        <div className="grid grid-cols-1 gap-4 md:gap-8">
                            <Card className="animate-slide-in-left">
                                <CardHeader>
                                    <CardTitle className="text-squidPink text-center">üéØ Game Lobby</CardTitle>
                                </CardHeader>
                                <CardContent className="space-y-4 md:space-y-6">
                                    {!gameId || !currentPlayerId ? (
                                        <div className="space-y-3 md:space-y-4">
                                            <Input
                                                type="text"
                                                placeholder="üë§ Your Player Name"
                                                value={playerName}
                                                onChange={(e) => setPlayerName(e.target.value)}
                                                className="w-full animate-slide-in-up"
                                            />
                                            <Input
                                                type="text"
                                                placeholder="üîë Enter Game Code"
                                                value={joinCode}
                                                onChange={(e) => setJoinCode(e.target.value.toUpperCase())}
                                                className="w-full animate-slide-in-up"
                                                style={{ animationDelay: '0.1s' }}
                                            />
                                            {error && <p className="text-squidRed mobile-text-sm text-center animate-bounce-in elimination-glitch">{error}</p>}
                                            <Button
                                                onClick={handleJoin}
                                                className="w-full animate-slide-in-up"
                                                style={{ animationDelay: '0.2s' }}
                                                variant="secondary"
                                            >
                                                üöÄ Join Game
                                            </Button>
                                        </div>
                                    ) : (
                                        <div className="text-center space-y-3 md:space-y-4 animate-bounce-in">
                                            <div className="p-3 md:p-4 bg-squidGray/50 rounded-lg border border-squidGreen/30">
                                                <p className="mobile-text-lg md:text-xl text-squidLightGray mb-2">
                                                    üéÆ Joined Game: <span className="font-mono text-squidGreen font-bold mobile-text-xl md:text-2xl animate-neon-border">{gameId}</span>
                                                </p>
                                                <p className="mobile-text-base md:text-lg text-squidLightGray mb-2">
                                                    üéØ Current Round: <span className="font-bold text-squidPink mobile-text-lg md:text-xl">{currentRound}</span>
                                                </p>
                                                <p className="mobile-text-base md:text-lg text-squidLightGray">
                                                    üí∞ Your Coins: <span className="font-bold text-squidGold mobile-text-lg md:text-xl">{coins}</span>
                                                </p>
                                            </div>
                                            {isAdmin && (
                                                <Button
                                                    onClick={onStartGame}
                                                    className="w-full animate-bounce-in"
                                                    variant="primary"
                                                >
                                                    üé¨ Start Game
                                                </Button>
                                            )}
                                        </div>
                                    )}
                                </CardContent>
                            </Card>

                            <Card className="animate-slide-in-right">
                                <CardHeader>
                                    <CardTitle className="text-squidGreen text-center">üë• Players in Lobby ({players.length})</CardTitle>
                                </CardHeader>
                                <CardContent>
                                    <div className="mobile-h-48 md:h-64 w-full rounded-lg border-2 border-squidPink/30 p-3 md:p-4 bg-squidGray/30 overflow-y-auto backdrop-blur-sm">
                                        {players.length === 0 ? (
                                            <p className="text-squidLightGray/70 text-center animate-pulse mobile-text-sm">
                                                ‚è≥ Waiting for players...
                                            </p>
                                        ) : (
                                            <ul className="space-y-2 md:space-y-3">
                                                {players.map((player, index) => (
                                                    <li key={player.id} className={`flex items-center justify-between text-squidLightGray p-2 md:p-3 rounded-lg bg-squidGray/50 animate-slide-in-up`} style={{ animationDelay: `${index * 0.1}s` }}>
                                                        <div className="flex items-center space-x-2 md:space-x-3">
                                                            <span className="font-mono text-squidGreen font-bold mobile-text-base md:text-lg">#{player.number}</span>
                                                            <span className="font-semibold mobile-text-sm md:text-base">{player.name}</span>
                                                        </div>
                                                        {player.isEliminated && <span className="text-squidRed font-bold animate-pulse mobile-text-sm">üíÄ ELIMINATED</span>}
                                                    </li>
                                                ))}
                                            </ul>
                                        )}
                                    </div>
                                </CardContent>
                            </Card>
                        </div>
                    </div>
                </div>
            );
        };

        // Red Light Green Light Game Component
const RedLightGreenLightGame = ({ onGameEnd, player }) => {
  const [gamePhase, setGamePhase] = useState("waiting");
  const [timer, setTimer] = useState(30);
  const [roundTimer, setRoundTimer] = useState(0);
  const [progress, setProgress] = useState(0);
  const [isRunning, setIsRunning] = useState(false);
  const [isEliminated, setIsEliminated] = useState(player?.isEliminated || false);
  const [message, setMessage] = useState("");
  const [coins, setCoins] = useLocalStorage("squid-game-coins", 0);

  useEffect(() => {
    if (isEliminated) {
      setMessage("üíÄ ELIMINATED!");
      playSound('elimination');
      onGameEnd(false);
      return;
    }

    if (gamePhase === "finished") {
      setMessage("üéâ SAFE! You crossed the line.");
      setCoins(prev => prev + 100);
      playSound('success');
      onGameEnd(true);
      return;
    }

    let gameInterval = null;
    if (gamePhase !== "waiting") {
      gameInterval = setInterval(() => {
        setTimer(prev => {
          if (prev <= 1) {
            clearInterval(gameInterval);
            if (progress < 100) {
              setIsEliminated(true);
            } else {
              setGamePhase("finished");
            }
            return 0;
          }
          return prev - 1;
        });
      }, 1000);
    }

    return () => {
      if (gameInterval) clearInterval(gameInterval);
    };
  }, [gamePhase, timer, progress, isEliminated, onGameEnd, setCoins]);

  useEffect(() => {
    if (gamePhase === "waiting" || isEliminated) return;

    let phaseInterval = null;
    const startPhase = () => {
      const isGreen = Math.random() > 0.4;
      const phaseDuration = Math.floor(Math.random() * 4) + 2;

      setGamePhase(isGreen ? "green" : "red");
      setRoundTimer(phaseDuration);
      setMessage(isGreen ? "üü¢ GREEN LIGHT! MOVE!" : "üî¥ RED LIGHT! STOP!");

      let currentPhaseTime = phaseDuration;
      phaseInterval = setInterval(() => {
        currentPhaseTime -= 1;
        setRoundTimer(currentPhaseTime);

        if (currentPhaseTime <= 0) {
          clearInterval(phaseInterval);
          if (gamePhase === "red" && isRunning) {
            setIsEliminated(true);
            return;
          }
          startPhase();
        }
      }, 1000);
    };

    startPhase();

    return () => {
      if (phaseInterval) clearInterval(phaseInterval);
    };
  }, [gamePhase === "waiting", isEliminated, isRunning]);

  useEffect(() => {
    if (isRunning && gamePhase === "green" && progress < 100 && !isEliminated) {
      const moveInterval = setInterval(() => {
        setProgress(prev => {
          const newProgress = Math.min(prev + 2, 100);
          if (newProgress >= 100) {
            setGamePhase("finished");
          }
          return newProgress;
        });
      }, 100);
      return () => clearInterval(moveInterval);
    }
  }, [isRunning, gamePhase, progress, isEliminated]);

  const toggleRunning = () => {
    if (isEliminated || gamePhase === "waiting" || gamePhase === "finished") return;
    
    const newRunningState = !isRunning;
    setIsRunning(newRunningState);
    
    if (newRunningState && gamePhase === "red") {
      setTimeout(() => {
        setIsEliminated(true);
      }, 200);
    }
  };

  const startGame = () => {
    setGamePhase("green");
    setTimer(30);
    setProgress(0);
    setIsEliminated(false);
    setIsRunning(false);
    setMessage("");
    playSound('success');
  };

  return (
    <div className="relative flex flex-col items-center justify-center min-h-screen bg-squidDark text-squidLightGray p-4 overflow-hidden screen-transition">
      {isEliminated && (
        <div className="absolute inset-0 bg-squidRed/90 flex items-center justify-center z-50 animate-fade-in elimination-glitch">
          <h2 className="mobile-text-4xl md:text-8xl font-bold text-white drop-shadow-lg font-orbitron text-center">üíÄ ELIMINATED</h2>
        </div>
      )}

      <div className="absolute top-4 left-4 mobile-text-sm md:text-lg font-mono text-squidGreen animate-slide-in-left">
        üé≠ Player: #{player?.number} {player?.name}
      </div>
      <div className="absolute top-4 right-4 mobile-text-sm md:text-lg font-mono text-squidPink animate-slide-in-right">
        ‚è∞ Time Left: {timer}s
      </div>

      <div className="relative w-full max-w-5xl mobile-h-64 md:h-80 bg-gradient-to-r from-squidGreen/20 via-squidPink/10 to-squidRed/20 rounded-xl overflow-hidden mb-6 md:mb-8 border-2 border-squidPink/50 shadow-2xl shadow-squidPink/20 animate-bounce-in">
        <div
          className={`absolute top-0 right-0 w-20 md:w-32 h-full bg-gradient-to-b from-squidGray to-squidDark flex items-center justify-center mobile-text-3xl md:text-6xl rounded-l-full transition-transform duration-500 animate-squid-pulse`}
          style={{ transform: gamePhase === "red" ? "rotateY(180deg)" : "rotateY(0deg)" }}
        >
          üëß
        </div>
        <div className="absolute bottom-4 md:bottom-6 left-4 md:left-6 right-4 md:right-6">
          <Progress value={progress} className="w-full mb-2" animated={true} />
          <div className="text-center mobile-text-sm md:text-lg text-squidLightGray font-bold">
            üèÉ‚Äç‚ôÇÔ∏è Progress: {progress.toFixed(0)}%
          </div>
        </div>
      </div>

      <h2 className="mobile-text-2xl md:text-6xl font-bold mb-6 md:mb-8 text-center text-white drop-shadow-lg font-orbitron animate-squid-pulse">
        {message || "üö¶ Red Light, Green Light"}
      </h2>

      <div className="mobile-text-xl md:text-4xl font-mono text-squidPink mb-6 md:mb-8 animate-bounce-in text-center">
        {gamePhase !== "waiting" && gamePhase !== "finished" && `‚è±Ô∏è Phase Timer: ${roundTimer}s`}
      </div>

      {gamePhase === "waiting" && (
        <Button
          onClick={startGame}
          className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl animate-bounce-in"
          variant="primary"
        >
          üé¨ Start Round
        </Button>
      )}

      {gamePhase !== "waiting" && gamePhase !== "finished" && !isEliminated && (
        <Button
          onClick={toggleRunning}
          className={`font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl transition-all duration-300 ${isRunning ? "scale-110 animate-pulse" : ""}`}
          variant={isRunning ? "primary" : "secondary"}
        >
          {isRunning ? "üõë STOP RUNNING" : "üèÉ‚Äç‚ôÇÔ∏è START RUNNING"}
        </Button>
      )}

      {gamePhase === "finished" && (
        <Button
          onClick={() => onGameEnd(true)}
          className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl animate-bounce-in"
          variant="accent"
        >
          ‚û°Ô∏è Continue
        </Button>
      )}
    </div>
  );
};

// Honeycomb Game Component
const HoneycombGame = ({ onGameEnd, player }) => {
  const canvasRef = useRef(null);
  const [selectedShape, setSelectedShape] = useState(null);
  const [timer, setTimer] = useState(60);
  const [isTracing, setIsTracing] = useState(false);
  const [isEliminated, setIsEliminated] = useState(player?.isEliminated || false);
  const [message, setMessage] = useState("");
  const [coins, setCoins] = useLocalStorage("squid-game-coins", 0);
  const [gameStarted, setGameStarted] = useState(false);
  const [tracePoints, setTracePoints] = useState([]);

  const shapes = ["circle", "triangle", "star", "umbrella"];
  const lastPoint = useRef(null);
  const shapePath = useRef(null);

  const drawShape = useCallback((ctx, shape) => {
    const centerX = ctx.canvas.width / 2;
    const centerY = ctx.canvas.height / 2;
    const size = 80;

    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
    ctx.strokeStyle = "#FF007F";
    ctx.lineWidth = 4;
    ctx.lineJoin = "round";
    ctx.lineCap = "round";

    const path = new Path2D();

    switch (shape) {
      case "circle":
        path.arc(centerX, centerY, size, 0, Math.PI * 2);
        break;
      case "triangle":
        path.moveTo(centerX, centerY - size);
        path.lineTo(centerX + (size * Math.sqrt(3)) / 2, centerY + size / 2);
        path.lineTo(centerX - (size * Math.sqrt(3)) / 2, centerY + size / 2);
        path.closePath();
        break;
      case "star":
        const outerRadius = size;
        const innerRadius = size / 2.5;
        const numPoints = 5;
        for (let i = 0; i < numPoints * 2; i++) {
          const radius = i % 2 === 0 ? outerRadius : innerRadius;
          const angle = (Math.PI / numPoints) * i - Math.PI / 2;
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);
          if (i === 0) {
            path.moveTo(x, y);
          } else {
            path.lineTo(x, y);
          }
        }
        path.closePath();
        break;
      case "umbrella":
        path.arc(centerX, centerY + size / 4, size, Math.PI, Math.PI * 2);
        path.moveTo(centerX - size, centerY + size / 4);
        path.lineTo(centerX - size / 4, centerY + size * 1.5);
        path.arc(centerX, centerY + size * 1.5, size / 4, Math.PI, Math.PI * 2);
        path.lineTo(centerX + size / 4, centerY + size * 1.5);
        path.lineTo(centerX + size, centerY + size / 4);
        break;
    }
    ctx.stroke(path);
    shapePath.current = path;
  }, []);

  const checkTraceAccuracy = useCallback(() => {
    const canvas = canvasRef.current;
    if (!canvas || !shapePath.current) return false;

    const ctx = canvas.getContext("2d");
    if (!ctx) return false;

    let insideCount = 0;
    const totalPoints = tracePoints.length;
    if (totalPoints === 0) return false;

    for (const point of tracePoints) {
      if (ctx.isPointInStroke(shapePath.current, point.x, point.y)) {
        insideCount++;
      }
    }
    return insideCount / totalPoints > 0.7;
  }, [tracePoints]);

  const handleMouseDown = useCallback((e) => {
    if (isEliminated || !gameStarted) return;
    const canvas = canvasRef.current;
    if (!canvas) return;

    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    lastPoint.current = { x, y };
    setTracePoints([{ x, y }]);
    setIsTracing(true);
  }, [isEliminated, gameStarted]);

  const handleMouseMove = useCallback((e) => {
    if (!isTracing || isEliminated || !gameStarted) return;
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext("2d");
    if (!ctx) return;

    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    if (lastPoint.current) {
      ctx.beginPath();
      ctx.moveTo(lastPoint.current.x, lastPoint.current.y);
      ctx.lineTo(x, y);
      ctx.strokeStyle = "#00A86B";
      ctx.lineWidth = 6;
      ctx.stroke();
      lastPoint.current = { x, y };
      setTracePoints(prev => [...prev, { x, y }]);
    }
  }, [isTracing, isEliminated, gameStarted]);

  const handleMouseUp = useCallback(() => {
    setIsTracing(false);
    lastPoint.current = null;
  }, []);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext("2d");
    if (!ctx) return;

    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    if (selectedShape) {
      drawShape(ctx, selectedShape);
    }
  }, [selectedShape, drawShape]);

  useEffect(() => {
    if (isEliminated || !gameStarted) return;

    let gameInterval = null;
    if (timer > 0) {
      gameInterval = setInterval(() => {
        setTimer(prev => prev - 1);
      }, 1000);
    } else {
      const survived = checkTraceAccuracy();
      if (survived) {
        setMessage("üéâ SUCCESS! You cut the shape.");
        setCoins(prev => prev + 150);
        playSound('success');
        onGameEnd(true);
      } else {
        setIsEliminated(true);
        setMessage("üíÄ FAILED! Shape broken or time ran out.");
        playSound('elimination');
        onGameEnd(false);
      }
    }

    return () => {
      if (gameInterval) clearInterval(gameInterval);
    };
  }, [timer, isEliminated, gameStarted, checkTraceAccuracy, onGameEnd, setCoins]);

  const startGame = () => {
    const randomShape = shapes[Math.floor(Math.random() * shapes.length)];
    setSelectedShape(randomShape);
    setTimer(60);
    setIsEliminated(false);
    setMessage("");
    setGameStarted(true);
    setTracePoints([]);
    playSound('success');
  };

  return (
    <div className="relative flex flex-col items-center justify-center min-h-screen bg-squidDark text-squidLightGray p-4 overflow-hidden screen-transition">
      {isEliminated && (
        <div className="absolute inset-0 bg-squidRed/90 flex items-center justify-center z-50 animate-fade-in elimination-glitch">
          <h2 className="mobile-text-4xl md:text-8xl font-bold text-white drop-shadow-lg font-orbitron text-center">üíÄ ELIMINATED</h2>
        </div>
      )}

      <div className="absolute top-4 left-4 mobile-text-sm md:text-lg font-mono text-squidGreen animate-slide-in-left">
        üé≠ Player: #{player?.number} {player?.name}
      </div>
      <div className="absolute top-4 right-4 mobile-text-sm md:text-lg font-mono text-squidPink animate-slide-in-right">
        ‚è∞ Time Left: {timer}s
      </div>

      <h2 className="mobile-text-2xl md:text-6xl font-bold mb-6 md:mb-8 text-center text-white drop-shadow-lg font-orbitron animate-squid-pulse">
        {message || `üçØ Honeycomb: Trace the ${selectedShape || "shape"}`}
      </h2>

      <div className="relative w-80 h-80 md:w-96 md:h-96 bg-squidGray rounded-lg border-2 border-squidPink/50 shadow-lg shadow-squidPink/20 flex items-center justify-center overflow-hidden animate-bounce-in">
        <canvas
          ref={canvasRef}
          className="w-full h-full cursor-crosshair"
          onMouseDown={handleMouseDown}
          onMouseMove={handleMouseMove}
          onMouseUp={handleMouseUp}
          onMouseLeave={handleMouseUp}
          onTouchStart={(e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousedown", {
              clientX: touch.clientX,
              clientY: touch.clientY
            });
            handleMouseDown(mouseEvent);
          }}
          onTouchMove={(e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousemove", {
              clientX: touch.clientX,
              clientY: touch.clientY
            });
            handleMouseMove(mouseEvent);
          }}
          onTouchEnd={handleMouseUp}
        />
      </div>

      <div className="w-80 md:w-96 mt-4">
        <Progress value={(timer / 60) * 100} className="w-full mb-2" animated={true} />
        <div className="text-center mobile-text-sm md:text-lg text-squidLightGray font-bold">
          ‚è±Ô∏è Time Progress
        </div>
      </div>

      {!gameStarted && (
        <Button
          onClick={startGame}
          className="mt-6 md:mt-8 font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl animate-bounce-in"
          variant="primary"
        >
          üé¨ Start Honeycomb
        </Button>
      )}
    </div>
  );
};

// Tug of War Game Component
const TugOfWarGame = ({ onGameEnd, player }) => {
  const [playerStrength, setPlayerStrength] = useState(0);
  const [opponentStrength, setOpponentStrength] = useState(0);
  const [timer, setTimer] = useState(20);
  const [gamePhase, setGamePhase] = useState("waiting");
  const [message, setMessage] = useState("");
  const [isEliminated, setIsEliminated] = useState(player?.isEliminated || false);
  const [coins, setCoins] = useLocalStorage("squid-game-coins", 0);

  const opponentIntervalRef = useRef(null);
  const gameTimerIntervalRef = useRef(null);

  useEffect(() => {
    if (isEliminated) {
      setMessage("üíÄ ELIMINATED!");
      playSound('elimination');
      onGameEnd(false);
      return;
    }

    if (gamePhase === "playing") {
      gameTimerIntervalRef.current = setInterval(() => {
        setTimer(prev => {
          if (prev <= 1) {
            clearInterval(gameTimerIntervalRef.current);
            setGamePhase("finished");
            return 0;
          }
          return prev - 1;
        });
      }, 1000);

      opponentIntervalRef.current = setInterval(() => {
        setOpponentStrength(prev => Math.min(prev + Math.random() * 3 + 1, 100));
      }, 800);
    } else if (gamePhase === "finished") {
      if (playerStrength >= 100) {
        setMessage("üéâ VICTORY! You pulled them over!");
        setCoins(prev => prev + 200);
        playSound('success');
        onGameEnd(true);
      } else {
        setIsEliminated(true);
        setMessage("üíÄ DEFEAT! You were pulled over.");
        playSound('elimination');
        onGameEnd(false);
      }
      if (opponentIntervalRef.current) clearInterval(opponentIntervalRef.current);
      if (gameTimerIntervalRef.current) clearInterval(gameTimerIntervalRef.current);
    }

    return () => {
      if (opponentIntervalRef.current) clearInterval(opponentIntervalRef.current);
      if (gameTimerIntervalRef.current) clearInterval(gameTimerIntervalRef.current);
    };
  }, [gamePhase, isEliminated, playerStrength, onGameEnd, setCoins]);

  const handlePull = () => {
    if (gamePhase !== "playing" || isEliminated) return;
    setPlayerStrength(prev => Math.min(prev + 8, 100));
    playSound('click');
  };

  const startGame = () => {
    setPlayerStrength(0);
    setOpponentStrength(0);
    setTimer(20);
    setIsEliminated(false);
    setMessage("");
    setGamePhase("playing");
    playSound('success');
  };

  return (
    <div className="relative flex flex-col items-center justify-center min-h-screen bg-squidDark text-squidLightGray p-4 overflow-hidden screen-transition">
      {isEliminated && (
        <div className="absolute inset-0 bg-squidRed/90 flex items-center justify-center z-50 animate-fade-in elimination-glitch">
          <h2 className="mobile-text-4xl md:text-8xl font-bold text-white drop-shadow-lg font-orbitron text-center">üíÄ ELIMINATED</h2>
        </div>
      )}

      <div className="absolute top-4 left-4 mobile-text-sm md:text-lg font-mono text-squidGreen animate-slide-in-left">
        üé≠ Player: #{player?.number} {player?.name}
      </div>
      <div className="absolute top-4 right-4 mobile-text-sm md:text-lg font-mono text-squidPink animate-slide-in-right">
        ‚è∞ Time Left: {timer}s
      </div>

      <h2 className="mobile-text-2xl md:text-6xl font-bold mb-6 md:mb-8 text-center text-white drop-shadow-lg font-orbitron animate-squid-pulse">
        {message || "üí™ Tug of War: Pull to Survive!"}
      </h2>

      <div className="w-full max-w-4xl space-y-4 md:space-y-6 mb-6 md:mb-8 animate-bounce-in">
        <div className="flex items-center justify-between mobile-text-lg md:text-2xl font-bold text-squidGreen">
          <span>üü¢ Your Team</span>
          <span>{playerStrength.toFixed(0)}%</span>
        </div>
        <Progress value={playerStrength} className="w-full mb-2" animated={true} />

        <div className="flex items-center justify-between mobile-text-lg md:text-2xl font-bold text-squidRed">
          <span>üî¥ Opponent Team</span>
          <span>{opponentStrength.toFixed(0)}%</span>
        </div>
        <Progress value={opponentStrength} className="w-full mb-2" animated={true} />
      </div>

      {gamePhase === "waiting" && (
        <Button
          onClick={startGame}
          className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl animate-bounce-in"
          variant="primary"
        >
          üé¨ Start Tug of War
        </Button>
      )}

      {gamePhase === "playing" && !isEliminated && (
        <Button
          onClick={handlePull}
          className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl transition-all duration-300 active:scale-95"
          variant="secondary"
        >
          üí™ PULL! (Click Rapidly)
        </Button>
      )}

      {gamePhase === "finished" && (
        <Button
          onClick={() => onGameEnd(playerStrength >= 100)}
          className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl animate-bounce-in"
          variant="accent"
        >
          ‚û°Ô∏è Continue
        </Button>
      )}
    </div>
  );
};

// Marbles Game Component
const MarblesGame = ({ onGameEnd, player }) => {
  const [opponentMarbles, setOpponentMarbles] = useState(0);
  const [playerGuess, setPlayerGuess] = useState(null);
  const [message, setMessage] = useState("");
  const [isEliminated, setIsEliminated] = useState(player?.isEliminated || false);
  const [gamePhase, setGamePhase] = useState("waiting");
  const [coins, setCoins] = useLocalStorage("squid-game-coins", 0);

  useEffect(() => {
    if (isEliminated) {
      setMessage("üíÄ ELIMINATED!");
      playSound('elimination');
      onGameEnd(false);
      return;
    }
  }, [isEliminated, onGameEnd]);

  const startGame = () => {
    const randomMarbles = Math.floor(Math.random() * 10) + 1;
    setOpponentMarbles(randomMarbles);
    setPlayerGuess(null);
    setMessage("ü§î Guess if I have an ODD or EVEN number of marbles.");
    setIsEliminated(false);
    setGamePhase("guessing");
    playSound('success');
  };

  const handleGuess = (guess) => {
    if (gamePhase !== "guessing") return;
    setPlayerGuess(guess);
    setGamePhase("revealing");
    setMessage("üé≤ Revealing...");

    setTimeout(() => {
      const isOpponentEven = opponentMarbles % 2 === 0;
      const isCorrect = (guess === "even" && isOpponentEven) || (guess === "odd" && !isOpponentEven);

      if (isCorrect) {
        setMessage(`üéâ Correct! I had ${opponentMarbles} marbles (${isOpponentEven ? "EVEN" : "ODD"}). You win!`);
        setCoins(prev => prev + 250);
        playSound('success');
        setGamePhase("finished");
      } else {
        setMessage(`üíÄ Incorrect! I had ${opponentMarbles} marbles (${isOpponentEven ? "EVEN" : "ODD"}). You lose.`);
        setIsEliminated(true);
        playSound('elimination');
        setGamePhase("finished");
      }
    }, 3000);
  };

  return (
    <div className="relative flex flex-col items-center justify-center min-h-screen bg-squidDark text-squidLightGray p-4 overflow-hidden screen-transition">
      {isEliminated && (
        <div className="absolute inset-0 bg-squidRed/90 flex items-center justify-center z-50 animate-fade-in elimination-glitch">
          <h2 className="mobile-text-4xl md:text-8xl font-bold text-white drop-shadow-lg font-orbitron text-center">üíÄ ELIMINATED</h2>
        </div>
      )}

      <div className="absolute top-4 left-4 mobile-text-sm md:text-lg font-mono text-squidGreen animate-slide-in-left">
        üé≠ Player: #{player?.number} {player?.name}
      </div>

      <h2 className="mobile-text-2xl md:text-6xl font-bold mb-6 md:mb-8 text-center text-white drop-shadow-lg font-orbitron animate-squid-pulse">
        {message || "ü™® Marbles: Guess Odd or Even"}
      </h2>

      <div className="flex flex-col items-center space-y-4 md:space-y-6 animate-bounce-in">
        {gamePhase === "waiting" && (
          <Button
            onClick={startGame}
            className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl"
            variant="primary"
          >
            üé¨ Start Marbles Game
          </Button>
        )}

        {gamePhase === "guessing" && (
          <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-4">
            <Button
              onClick={() => handleGuess("odd")}
              className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl"
              variant="secondary"
            >
              üî¢ ODD
            </Button>
            <Button
              onClick={() => handleGuess("even")}
              className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl"
              variant="accent"
            >
              üî¢ EVEN
            </Button>
          </div>
        )}

        {gamePhase === "revealing" && (
          <div className="text-center mobile-text-2xl md:text-4xl font-bold text-squidPink animate-pulse">
            üé≤ Revealing...
            <div className="mobile-text-4xl md:text-8xl mt-4 animate-bounce">ü™®</div>
          </div>
        )}

        {gamePhase === "finished" && (
          <Button
            onClick={() => onGameEnd(!isEliminated)}
            className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl"
            variant="secondary"
          >
            ‚û°Ô∏è Continue
          </Button>
        )}
      </div>
    </div>
  );
};

// Glass Bridge Game Component
const GlassBridgeGame = ({ onGameEnd, player }) => {
  const [currentStep, setCurrentStep] = useState(0);
  const [bridgeLayout, setBridgeLayout] = useState([]);
  const [message, setMessage] = useState("");
  const [isEliminated, setIsEliminated] = useState(player?.isEliminated || false);
  const [gamePhase, setGamePhase] = useState("waiting");
  const [coins, setCoins] = useLocalStorage("squid-game-coins", 0);
  const [selectedPanel, setSelectedPanel] = useState(null);

  const NUM_STEPS = 5;

  useEffect(() => {
    if (isEliminated) {
      setMessage("üíÄ ELIMINATED!");
      playSound('elimination');
      onGameEnd(false);
      return;
    }
    if (gamePhase === "finished" && !isEliminated) {
      setMessage("üéâ SUCCESS! You crossed the Glass Bridge!");
      setCoins(prev => prev + 300);
      playSound('success');
      onGameEnd(true);
    }
  }, [isEliminated, gamePhase, onGameEnd, setCoins]);

  const generateBridge = () => {
    const layout = [];
    for (let i = 0; i < NUM_STEPS; i++) {
      layout.push(Math.random() > 0.5);
    }
    setBridgeLayout(layout);
  };

  const startGame = () => {
    generateBridge();
    setCurrentStep(0);
    setMessage("ü§î Choose your path wisely.");
    setIsEliminated(false);
    setSelectedPanel(null);
    setGamePhase("playing");
    playSound('success');
  };

  const handlePanelClick = (panelIndex) => {
    if (gamePhase !== "playing" || isEliminated || selectedPanel !== null) return;

    setSelectedPanel(panelIndex);

    setTimeout(() => {
      const isSafe = bridgeLayout[currentStep] === (panelIndex === 0);
      if (isSafe) {
        setMessage("‚úÖ Safe! Proceed to the next step.");
        playSound('success');
        setCurrentStep(prev => prev + 1);
        setSelectedPanel(null);
        if (currentStep + 1 >= NUM_STEPS) {
          setGamePhase("finished");
        }
      } else {
        setMessage("üí• Shattered! You fell.");
        setIsEliminated(true);
        playSound('elimination');
        setGamePhase("finished");
      }
    }, 1500);
  };

  return (
    <div className="relative flex flex-col items-center justify-center min-h-screen bg-squidDark text-squidLightGray p-4 overflow-hidden screen-transition">
      {isEliminated && (
        <div className="absolute inset-0 bg-squidRed/90 flex items-center justify-center z-50 animate-fade-in elimination-glitch">
          <h2 className="mobile-text-4xl md:text-8xl font-bold text-white drop-shadow-lg font-orbitron text-center">üíÄ ELIMINATED</h2>
        </div>
      )}

      <div className="absolute top-4 left-4 mobile-text-sm md:text-lg font-mono text-squidGreen animate-slide-in-left">
        üé≠ Player: #{player?.number} {player?.name}
      </div>

      <h2 className="mobile-text-2xl md:text-6xl font-bold mb-6 md:mb-8 text-center text-white drop-shadow-lg font-orbitron animate-squid-pulse">
        {message || "üåâ Glass Bridge: Choose Your Panel"}
      </h2>

      <div className="flex flex-col items-center space-y-4 md:space-y-6 w-full max-w-2xl animate-bounce-in">
        <div className="relative w-full h-8 md:h-12 bg-squidGray rounded-full overflow-hidden border-2 border-squidPink/50 shadow-lg shadow-squidPink/20">
          <div
            className="absolute h-full bg-squidGreen transition-all duration-500 ease-out"
            style={{ width: `${(currentStep / NUM_STEPS) * 100}%` }}
          />
          <div className="absolute inset-0 flex items-center justify-center text-squidLightGray font-bold mobile-text-sm md:text-lg">
            Step {currentStep} / {NUM_STEPS}
          </div>
        </div>

        {gamePhase === "waiting" && (
          <Button
            onClick={startGame}
            className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl"
            variant="primary"
          >
            üé¨ Start Glass Bridge
          </Button>
        )}

        {gamePhase === "playing" && !isEliminated && (
          <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-4 mt-6 md:mt-8">
            <Button
              onClick={() => handlePanelClick(0)}
              disabled={selectedPanel !== null}
              className={`relative w-32 h-32 md:w-40 md:h-40 bg-squidGray hover:bg-squidGray/80 text-white font-bold mobile-text-lg md:text-2xl rounded-lg transition-all duration-300 flex flex-col items-center justify-center border-2 border-squidPink/50 shadow-lg shadow-squidPink/20 ${selectedPanel === 0 ? "scale-105 ring-4 ring-squidPink" : ""}`}
              variant="ghost"
            >
              {selectedPanel === 0 && bridgeLayout[currentStep] === true && (
                <div className="absolute text-squidGreen mobile-text-4xl md:text-6xl animate-bounce">‚úÖ</div>
              )}
              {selectedPanel === 0 && bridgeLayout[currentStep] === false && (
                <div className="absolute text-squidRed mobile-text-4xl md:text-6xl animate-pulse">‚ùå</div>
              )}
              ‚¨ÖÔ∏è Left Panel
            </Button>
            <Button
              onClick={() => handlePanelClick(1)}
              disabled={selectedPanel !== null}
              className={`relative w-32 h-32 md:w-40 md:h-40 bg-squidGray hover:bg-squidGray/80 text-white font-bold mobile-text-lg md:text-2xl rounded-lg transition-all duration-300 flex flex-col items-center justify-center border-2 border-squidPink/50 shadow-lg shadow-squidPink/20 ${selectedPanel === 1 ? "scale-105 ring-4 ring-squidPink" : ""}`}
              variant="ghost"
            >
              {selectedPanel === 1 && bridgeLayout[currentStep] === false && (
                <div className="absolute text-squidGreen mobile-text-4xl md:text-6xl animate-bounce">‚úÖ</div>
              )}
              {selectedPanel === 1 && bridgeLayout[currentStep] === true && (
                <div className="absolute text-squidRed mobile-text-4xl md:text-6xl animate-pulse">‚ùå</div>
              )}
              Right Panel ‚û°Ô∏è
            </Button>
          </div>
        )}

        {gamePhase === "finished" && (
          <Button
            onClick={() => onGameEnd(!isEliminated)}
            className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl"
            variant="secondary"
          >
            ‚û°Ô∏è Continue
          </Button>
        )}
      </div>
    </div>
  );
};

// Final Squid Game Component
const FinalSquidGame = ({ onGameEnd, player }) => {
  const [playerHealth, setPlayerHealth] = useState(100);
  const [opponentHealth, setOpponentHealth] = useState(100);
  const [message, setMessage] = useState("‚öîÔ∏è The Final Game Begins!");
  const [isEliminated, setIsEliminated] = useState(player?.isEliminated || false);
  const [gamePhase, setGamePhase] = useState("waiting");
  const [coins, setCoins] = useLocalStorage("squid-game-coins", 0);
  const [playerAction, setPlayerAction] = useState(null);
  const [opponentAction, setOpponentAction] = useState(null);

  useEffect(() => {
    if (playerHealth <= 0 && gamePhase === "playing") {
      setMessage("üíÄ You were defeated! ELIMINATED.");
      setIsEliminated(true);
      setGamePhase("finished");
      playSound('elimination');
    } else if (opponentHealth <= 0 && gamePhase === "playing") {
      setMessage("üèÜ VICTORY! You won the Squid Game!");
      setCoins(prev => prev + 1000);
      setGamePhase("finished");
      playSound('success');
    }
  }, [playerHealth, opponentHealth, gamePhase, setCoins]);

  const startGame = () => {
    setPlayerHealth(100);
    setOpponentHealth(100);
    setMessage("‚öîÔ∏è Choose your move!");
    setIsEliminated(false);
    setPlayerAction(null);
    setOpponentAction(null);
    setGamePhase("playing");
    playSound('success');
  };

  const handlePlayerMove = (action) => {
    if (gamePhase !== "playing" || isEliminated) return;

    setPlayerAction(action);
    const randomOpponentAction = Math.random() > 0.5 ? "attack" : "defend";
    setOpponentAction(randomOpponentAction);

    setTimeout(() => {
      let newPlayerHealth = playerHealth;
      let newOpponentHealth = opponentHealth;
      let roundMessage = "";

      if (action === "attack" && randomOpponentAction === "defend") {
        roundMessage = "‚öîÔ∏èüõ°Ô∏è You attacked, opponent defended. No damage.";
      } else if (action === "defend" && randomOpponentAction === "attack") {
        roundMessage = "üõ°Ô∏è‚öîÔ∏è You defended, opponent attacked. No damage.";
      } else if (action === "attack" && randomOpponentAction === "attack") {
        const damage = Math.floor(Math.random() * 20) + 15;
        newOpponentHealth = Math.max(0, opponentHealth - damage);
        newPlayerHealth = Math.max(0, playerHealth - damage);
        roundMessage = `‚öîÔ∏è‚öîÔ∏è Both attacked! You took ${damage} damage, opponent took ${damage} damage.`;
        playSound('click');
      } else if (action === "defend" && randomOpponentAction === "defend") {
        roundMessage = "üõ°Ô∏èüõ°Ô∏è Both defended. Nothing happened.";
      }

      setPlayerHealth(newPlayerHealth);
      setOpponentHealth(newOpponentHealth);
      setMessage(roundMessage);
      setPlayerAction(null);
      setOpponentAction(null);
    }, 2000);
  };

  return (
    <div className="relative flex flex-col items-center justify-center min-h-screen bg-squidDark text-squidLightGray p-4 overflow-hidden screen-transition">
      {isEliminated && (
        <div className="absolute inset-0 bg-squidRed/90 flex items-center justify-center z-50 animate-fade-in elimination-glitch">
          <h2 className="mobile-text-4xl md:text-8xl font-bold text-white drop-shadow-lg font-orbitron text-center">üíÄ ELIMINATED</h2>
        </div>
      )}

      <div className="absolute top-4 left-4 mobile-text-sm md:text-lg font-mono text-squidGreen animate-slide-in-left">
        üé≠ Player: #{player?.number} {player?.name}
      </div>

      <h2 className="mobile-text-2xl md:text-6xl font-bold mb-6 md:mb-8 text-center text-white drop-shadow-lg font-orbitron animate-squid-pulse">
        {message || "ü¶ë The Final Squid Game"}
      </h2>

      <div className="flex flex-col md:flex-row justify-around w-full max-w-4xl mb-6 md:mb-8 space-y-4 md:space-y-0 animate-bounce-in">
        <div className="flex flex-col items-center">
          <h3 className="mobile-text-lg md:text-2xl font-bold text-squidGreen mb-2">üü¢ Your Health</h3>
          <Progress value={playerHealth} className="w-40 md:w-48 mb-2" animated={true} />
          <span className="mobile-text-lg md:text-xl font-bold">{playerHealth}%</span>
        </div>
        <div className="flex flex-col items-center">
          <h3 className="mobile-text-lg md:text-2xl font-bold text-squidRed mb-2">üî¥ Opponent Health</h3>
          <Progress value={opponentHealth} className="w-40 md:w-48 mb-2" animated={true} />
          <span className="mobile-text-lg md:text-xl font-bold">{opponentHealth}%</span>
        </div>
      </div>

      {gamePhase === "waiting" && (
        <Button
          onClick={startGame}
          className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl animate-bounce-in"
          variant="primary"
        >
          üé¨ Start Final Game
        </Button>
      )}

      {gamePhase === "playing" && !isEliminated && (
        <div className="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-6 mt-6 md:mt-8">
          <Button
            onClick={() => handlePlayerMove("attack")}
            disabled={playerAction !== null}
            className={`font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl transition-all duration-300 flex items-center justify-center space-x-2 ${playerAction === "attack" ? "scale-105 ring-4 ring-squidGreen" : ""}`}
            variant="secondary"
          >
            <span className="mobile-text-2xl md:text-3xl">‚öîÔ∏è</span>
            <span>Attack</span>
          </Button>
          <Button
            onClick={() => handlePlayerMove("defend")}
            disabled={playerAction !== null}
            className={`font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl transition-all duration-300 flex items-center justify-center space-x-2 ${playerAction === "defend" ? "scale-105 ring-4 ring-squidPink" : ""}`}
            variant="accent"
          >
            <span className="mobile-text-2xl md:text-3xl">üõ°Ô∏è</span>
            <span>Defend</span>
          </Button>
        </div>
      )}

      {gamePhase === "finished" && (
        <Button
          onClick={() => onGameEnd(!isEliminated)}
          className="font-bold py-4 px-8 md:py-6 md:px-12 mobile-text-lg md:text-2xl rounded-xl animate-bounce-in"
          variant="secondary"
        >
          {isEliminated ? "üè† Return to Lobby" : "üèÜ Claim Your Prize!"}
        </Button>
      )}
    </div>
  );
};

        // Announcement Banner Component
        const AnnouncementBanner = ({ announcement }) => {
            if (!announcement) return null;
            
            return (
                <div className="fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-squidRed via-squidPink to-squidRed p-3 md:p-4 shadow-2xl animate-slide-in-down">
                    <div className="max-w-6xl mx-auto flex items-center justify-center">
                        <div className="flex items-center space-x-2 md:space-x-3 text-white">
                            <span className="mobile-text-lg md:text-2xl animate-bounce">üì¢</span>
                            <span className="mobile-text-base md:text-xl font-bold font-orbitron animate-squid-pulse">
                                ADMIN ANNOUNCEMENT:
                            </span>
                            <span className="mobile-text-sm md:text-lg font-semibold">
                                {announcement.text}
                            </span>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [isLoading, setIsLoading] = useState(true);
            const [currentView, setCurrentView] = useState("lobby");
            const [isAdminLoggedIn, setIsAdminLoggedIn] = useLocalStorage("squid-game-admin-logged-in", false);
            const [gameId, setGameId] = useState(null);
            const [players, setPlayers] = useState([]);
            const [currentPlayer, setCurrentPlayer] = useState(null);
            const [currentPlayerId, setCurrentPlayerId] = useLocalStorage("squid-game-player-id", null);
            const [currentRound, setCurrentRound] = useState(0);
            const [coins] = useLocalStorage("squid-game-coins", 0);
            const [message, setMessage] = useState("");
            const [currentAnnouncement, setCurrentAnnouncement] = useState(null);

            // Handle loading completion
            const handleLoadComplete = () => {
                setIsLoading(false);
                if (isAdminLoggedIn) {
                    setCurrentView("admin");
                }
            };

            // Firebase Realtime Database Listener
            useEffect(() => {
                if (!gameId) return;

                const gameRef = database.ref(`games/${gameId}`);
                const unsubscribe = gameRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        setCurrentRound(data.currentRound || 0);
                        const fetchedPlayers = [];
                        if (data.players) {
                            Object.keys(data.players).forEach((playerId) => {
                                fetchedPlayers.push({ id: playerId, ...data.players[playerId] });
                            });
                        }
                        setPlayers(fetchedPlayers);

                        // Handle announcements
                        if (data.announcement) {
                            if (!currentAnnouncement || currentAnnouncement.id !== data.announcement.id) {
                                playSound('notification');
                            }
                            setCurrentAnnouncement(data.announcement);
                        } else {
                            setCurrentAnnouncement(null);
                        }

                        // Update current player's status based on Firebase
                        if (currentPlayerId) {
                            const updatedCurrentPlayer = fetchedPlayers.find((p) => p.id === currentPlayerId);
                            if (updatedCurrentPlayer) {
                                setCurrentPlayer(updatedCurrentPlayer);
                                if (updatedCurrentPlayer.isEliminated && currentView !== "game-over") {
                                    setMessage("üíÄ You have been eliminated!");
                                    setCurrentView("game-over");
                                }
                            }
                        }

                        // Only auto-switch views for non-admin users
                        if (!isAdminLoggedIn && data.status === "playing") {
                            switch (data.currentRound) {
                                case 1:
                                    setCurrentView("red-light-green-light");
                                    break;
                                case 2:
                                    setCurrentView("honeycomb");
                                    break;
                                case 3:
                                    setCurrentView("tug-of-war");
                                    break;
                                case 4:
                                    setCurrentView("marbles");
                                    break;
                                case 5:
                                    setCurrentView("glass-bridge");
                                    break;
                                case 6:
                                    setCurrentView("squid-game");
                                    break;
                                default:
                                    if (data.currentRound > 6) {
                                        setMessage("üéâ All games completed! Congratulations! You are the last survivor.");
                                        setCurrentView("game-over");
                                    }
                                    break;
                            }
                        } else if (!isAdminLoggedIn && data.status === "lobby" && currentRound === 0) {
                            setCurrentView("lobby");
                        }
                    } else {
                        // Game was deleted or doesn't exist
                        setGameId(null);
                        setPlayers([]);
                        setCurrentPlayer(null);
                        if (!isAdminLoggedIn) {
                            setCurrentPlayerId(null);
                            setCurrentRound(0);
                            setMessage("üîå The game session has ended or was deleted.");
                            setCurrentView("game-over");
                        }
                    }
                });

                return () => {
                    gameRef.off('value', unsubscribe);
                };
            }, [gameId, currentPlayerId, currentRound, currentView, isAdminLoggedIn, currentAnnouncement]);

            const handleAdminLoginSuccess = () => {
                setIsAdminLoggedIn(true);
                setCurrentView("admin");
            };

            const handleAdminLogout = () => {
                setIsAdminLoggedIn(false);
                setGameId(null);
                setCurrentPlayer(null);
                setCurrentPlayerId(null);
                setCurrentRound(0);
                setPlayers([]);
                setCurrentView("lobby");
            };

            const handleJoinGame = async (code, playerName, playerId) => {
                setGameId(code);
                setCurrentPlayerId(playerId);

                const gamePlayersRef = database.ref(`games/${code}/players`);
                const snapshot = await gamePlayersRef.once('value');
                const existingPlayers = snapshot.val() || {};
                const newPlayerNumber = Object.keys(existingPlayers).length + 1;

                const newPlayer = {
                    id: playerId,
                    name: playerName,
                    number: newPlayerNumber,
                    isEliminated: false,
                };

                // Add player to Firebase
                await database.ref(`games/${code}/players/${playerId}`).set(newPlayer);
                setCurrentPlayer(newPlayer);
                
                // Only redirect to lobby if not admin
                if (!isAdminLoggedIn) {
                    setCurrentView("lobby");
                }
            };

            const handleGameEnd = async (survived) => {
                if (currentPlayer && gameId) {
                    if (!survived) {
                        // Update player's elimination status in Firebase
                        await database.ref(`games/${gameId}/players/${currentPlayer.id}`).update({
                            isEliminated: true,
                        });
                        setMessage("üíÄ You were eliminated!");
                        setCurrentView("game-over");
                    } else {
                        setMessage("üéâ You survived the round!");
                        setCurrentView("lobby"); // Return to lobby to wait for next round
                    }
                }
            };

            if (isLoading) {
                return (
                    <>
                        <ParticleSystem />
                        <LoadingScreen onLoadComplete={handleLoadComplete} />
                    </>
                );
            }

            const renderView = () => {
                const commonEliminatedScreen = (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-squidDark text-squidLightGray screen-transition px-4">
                        <h2 className="mobile-text-3xl md:text-5xl font-bold text-squidRed mb-4 font-orbitron animate-squid-pulse text-center">
                            üíÄ You are eliminated or not joined!
                        </h2>
                        <Button onClick={() => setCurrentView("lobby")} className="animate-bounce-in" variant="secondary">
                            üè† Return to Lobby
                        </Button>
                    </div>
                );

                // If current player is eliminated, show eliminated screen unless already on game-over or admin
                if (currentPlayer && currentPlayer.isEliminated && currentView !== "game-over" && !isAdminLoggedIn) {
                    return commonEliminatedScreen;
                }

                switch (currentView) {
                  case "login":
                    return <AdminLogin onLoginSuccess={handleAdminLoginSuccess} />;
                  case "admin":
                    return (
                      <AdminDashboard
                        onLogout={handleAdminLogout}
                        players={players}
                        gameId={gameId}
                        setGameId={setGameId}
                        currentRound={currentRound}
                      />
                    );
                  case "lobby":
                    return (
                      <Lobby
                        onJoinGame={handleJoinGame}
                        players={players}
                        gameId={gameId}
                        onStartGame={async () => {
                          if (gameId) {
                            await database.ref(`games/${gameId}`).update({ currentRound: 1, status: "playing" });
                          }
                        }}
                        isAdmin={isAdminLoggedIn}
                        currentRound={currentRound}
                        currentPlayerId={currentPlayerId}
                      />
                    );
                  case "red-light-green-light":
                    if (!currentPlayer && !isAdminLoggedIn) return commonEliminatedScreen;
                    return <RedLightGreenLightGame onGameEnd={handleGameEnd} player={currentPlayer} />;
                  case "honeycomb":
                    if (!currentPlayer && !isAdminLoggedIn) return commonEliminatedScreen;
                    return <HoneycombGame onGameEnd={handleGameEnd} player={currentPlayer} />;
                  case "tug-of-war":
                    if (!currentPlayer && !isAdminLoggedIn) return commonEliminatedScreen;
                    return <TugOfWarGame onGameEnd={handleGameEnd} player={currentPlayer} />;
                  case "marbles":
                    if (!currentPlayer && !isAdminLoggedIn) return commonEliminatedScreen;
                    return <MarblesGame onGameEnd={handleGameEnd} player={currentPlayer} />;
                  case "glass-bridge":
                    if (!currentPlayer && !isAdminLoggedIn) return commonEliminatedScreen;
                    return <GlassBridgeGame onGameEnd={handleGameEnd} player={currentPlayer} />;
                  case "squid-game":
                    if (!currentPlayer && !isAdminLoggedIn) return commonEliminatedScreen;
                    return <FinalSquidGame onGameEnd={handleGameEnd} player={currentPlayer} />;
                  case "game-over":
                    return (
                      <GameOver
                        message={message}
                        coins={coins}
                        onPlayAgain={() => {
                          localStorage.removeItem("squid-game-player-id");
                          localStorage.removeItem("squid-game-coins");
                          window.location.reload();
                        }}
                        onBackToLobby={() => setCurrentView("lobby")}
                      />
                    );
                  default:
                    return null;
                }
            };

            // Determine if we should show navigation buttons
            const shouldShowNavButtons = () => {
                // Don't show buttons if admin is logged in
                if (isAdminLoggedIn) return false;
                
                // Don't show buttons if game is in progress (not lobby or game-over)
                if (currentRound > 0 && currentView !== "lobby" && currentView !== "game-over") return false;
                
                // Show buttons in lobby or game-over states for non-admin users
                return currentView === "lobby" || currentView === "game-over" || currentView === "login";
            };

            return (
                <div className="min-h-screen bg-squidDark">
                    <ParticleSystem />
                    {currentAnnouncement && <AnnouncementBanner announcement={currentAnnouncement} />}
                    {renderView()}
                    {shouldShowNavButtons() && (
                        <div className="fixed bottom-4 right-4 flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 z-50">
                            <Button
                                onClick={() => setCurrentView("login")}
                                className="mobile-text-sm px-3 py-2 md:px-4 md:py-2 animate-slide-in-right"
                                variant="accent"
                            >
                                üé≠ Admin Login
                            </Button>
                            <Button
                                onClick={() => setCurrentView("lobby")}
                                className="mobile-text-sm px-3 py-2 md:px-4 md:py-2 animate-slide-in-right"
                                style={{ animationDelay: '0.1s' }}
                                variant="secondary"
                            >
                                üè† Player Lobby
                            </Button>
                        </div>
                    )}
                </div>
            );
        };

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
